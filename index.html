<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏û‡∏π‡∏î ‚Üí ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏´‡∏ç‡πà</title>

<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:system-ui,sans-serif;
  height:100vh;
  display:flex;
  flex-direction:column;
}
#text{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:24px;
  font-size:96px;
  line-height:1.25;
  word-break:break-word;
}
#status{
  text-align:center;
  font-size:36px;
  font-weight:bold;
  color:#00ff00;
  padding:10px;
  display:none;
}
.controls{
  padding:16px;
  display:flex;
  gap:10px;
}
button{
  flex:1;
  font-size:34px;
  padding:24px;
  border:none;
  border-radius:18px;
  font-weight:bold;
}
#mic{
  background:#1db954;
  color:black;
}
.size{
  background:#333;
  color:white;
}
</style>
</head>

<body>

<div id="text"></div>
<div id="status">üé§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á‚Ä¶ <span id="timer">0</span></div>

<div class="controls">
  <button class="size" id="minus">A‚àí</button>
  <button id="mic">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î</button>
  <button class="size" id="plus">A+</button>
</div>

<script>
/* ===== CONFIG ===== */
const MAX_WAIT = 10;       // ‡∏ü‡∏±‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏ß‡∏¥
const KEEP_ALIVE = 2500;  // ‡∏ï‡πà‡∏≠‡πÑ‡∏°‡∏Ñ‡πå‡∏ó‡∏∏‡∏Å 2.5 ‡∏ß‡∏¥

/* ===== ELEMENT ===== */
const textDiv = document.getElementById("text");
const statusDiv = document.getElementById("status");
const timerSpan = document.getElementById("timer");
const micBtn = document.getElementById("mic");

/* ===== FONT ===== */
const FONT_SIZES=[72,96,120,150];
let fontIndex=1;
function applyFont(){
  textDiv.style.fontSize=FONT_SIZES[fontIndex]+"px";
}
applyFont();
document.getElementById("plus").onclick=()=>{
  if(fontIndex<FONT_SIZES.length-1){fontIndex++;applyFont();}
};
document.getElementById("minus").onclick=()=>{
  if(fontIndex>0){fontIndex--;applyFont();}
};

/* ===== SPEECH ===== */
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

const recog = new SpeechRecognition();
recog.lang="th-TH";
recog.continuous=false;
recog.interimResults=false;

/* ===== STATE ===== */
let listening=false;
let seconds=0;
let timerInterval, keepAliveInterval;

/* ===== CONTROL ===== */
micBtn.onclick=()=>{
  listening ? stopListening() : startListening();
};

function startListening(){
  listening=true;
  seconds=0;
  timerSpan.innerText="0";
  statusDiv.style.display="block";

  micBtn.innerText="‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î";
  micBtn.style.background="#ff5252";

  startRecognizer();

  timerInterval=setInterval(()=>{
    seconds++;
    timerSpan.innerText=seconds;
    if(seconds>=MAX_WAIT) stopListening();
  },1000);

  // üëá ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
  keepAliveInterval=setInterval(()=>{
    if(listening){
      try{ recog.stop(); }catch(e){}
      setTimeout(()=>startRecognizer(),100);
    }
  },KEEP_ALIVE);
}

function startRecognizer(){
  try{ recog.start(); }catch(e){}
}

function stopListening(){
  listening=false;
  clearInterval(timerInterval);
  clearInterval(keepAliveInterval);
  try{ recog.stop(); }catch(e){}

  statusDiv.style.display="none";
  micBtn.innerText="‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î";
  micBtn.style.background="#1db954";
}

/* ===== RESULT ===== */
recog.onresult=(e)=>{
  const txt=e.results[0][0].transcript.trim();
  textDiv.innerText=txt;
  stopListening();
};

recog.onerror=()=>{};
recog.onend=()=>{};
</script>

</body>
</html>
